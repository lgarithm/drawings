# -*- mode: sh -*-

set -e

opts='-std=c++0x'

move(){
    cp $1/*.cpp build
    cp $1/*.h build
}

prepare_source(){
    for m in `ls src/modules`; do
	echo "preparing module $m"
	move src/modules/$m
    done

    move src/apps/ray
}

gen_build_makefile(){
    echo "default: binary"

    echo "objects:"
    for c in `ls *.cpp | grep -v _test.cpp`; do
	echo -e "\tg++ $opts -c $c"
    done

    echo "binary: objects"
    echo -e "\tmkdir -p ../bin"
    echo -e "\tg++ $opts *.o -o ../bin/ray"
}

gen_makefile(){
    echo "main:"
    echo -e "\tcd build && make"

    echo "check:"
    echo -e "\t./bin/ray -t"
}

config(){
    mkdir -p build
    prepare_source
    cd build
    gen_build_makefile > Makefile
    cd ..
    gen_makefile > Makefile
}

config
